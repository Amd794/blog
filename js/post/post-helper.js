function initPostHelper(){KEEP.utils.postHelper={postPageContainerDom:document.querySelector(".post-page-container"),toggleShowTocBtn:document.querySelector(".toggle-show-toc"),toggleShowTocTabletBtn:document.querySelector(".toggle-show-toc-tablet"),toggleShowTocIcon:document.querySelector(".toggle-show-toc i"),mainContentDom:document.querySelector(".main-content"),postToolsDom:document.querySelector(".post-tools"),isShowToc:!1,initToggleToc(){this.toggleShowTocBtn&&this.toggleShowTocBtn.addEventListener("click",()=>{this.isShowToc=!this.isShowToc,KEEP.themeInfo.styleStatus.isShowToc=this.isShowToc,KEEP.setStyleStatus(),this.handleToggleToc(this.isShowToc)}),this.toggleShowTocTabletBtn&&this.toggleShowTocTabletBtn.addEventListener("click",()=>{const e=document.querySelector(".tablet-post-toc-mask"),t=e.querySelector(".tablet-post-toc");document.body.style.overflow="hidden",e.style.background="rgba(0, 0, 0, 0.25)",e.style.visibility="visible",t.style.transform="translateX(0)",e.addEventListener("click",()=>{document.body.style.overflow="",e.style.background="rgba(0, 0, 0, 0)",e.style.visibility="hidden",t.style.transform="translateX(-100%)"})})},handleToggleToc(e){e?(this.postPageContainerDom.classList.add("show-toc"),document.body.classList.add("has-toc")):(this.postPageContainerDom.classList.remove("show-toc"),document.body.classList.remove("has-toc")),setTimeout(()=>{this.setPostToolsLayout()},120)},hasToc(e){this.toggleShowTocBtn&&(this.toggleShowTocBtn.style.display="flex",this.isShowToc=e,this.handleToggleToc(e))},setPostToolsLayout(e){const t=e||this.mainContentDom.getBoundingClientRect().width.toFixed(0);let o=5;window.innerWidth<=800&&(o=3);const s="left"===KEEP.theme_config.toc?.layout?"right":"left";this.postToolsDom.style.opacity="1",this.postToolsDom.style[s]=`calc((100vw - ${t}px) / 2 - ${o}rem)`},initSetPostToolsLeft(){setTimeout(()=>{this.setPostToolsLayout()},150),window.addEventListener("resize",()=>{this.setPostToolsLayout()})},goToComments(){const e=document.querySelector("#comments-anchor");[document.querySelector(".post-tools .go-to-comments"),document.querySelector(".exposed-tools-list .go-to-comments-tablet")].forEach(t=>{KEEP.utils.title2Top4HTag(t,e,300)})},watchPostCommentsCount(){const e=this.postToolsDom.querySelector(".post-comments-count");if(!e)return;const t=new MutationObserver(function(o){o.forEach(o=>{if("childList"===o.type){const s=Number(o.target.innerHTML);s>0&&(e.style.display="flex",s>99&&(e.innerHTML="99+",t.disconnect()))}})});t.observe(e,{attributes:!0,childList:!0})},setArticleAgingDays(){const e=document.querySelector(".post-content .post-aging-tips");if(e){const t=e.querySelector(".days"),o=Date.now(),s=864e5,n=(e.dataset?.agingDays||30)*s,l=o-new Date(e.dataset.updateDate).getTime(),c=(l/s).toFixed(0);l>=n&&(t.innerHTML=c,e.style.display="block")}},formatDatetime(e="YYYY-MM-DD hh:mm:ss",t=Date.now()){function o(e){return`00${e}`.substr(e.length)}const s=new Date(t);(/(y+)/.test(e)||/(Y+)/.test(e))&&(e=e.replace(RegExp.$1,`${s.getFullYear()}`.substr(4-RegExp.$1.length)));const n={"M+":s.getMonth()+1,"D+":s.getDate(),"d+":s.getDate(),"H+":s.getHours(),"h+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds()};for(const t in n)if(new RegExp(`(${t})`).test(e)){const s=`${n[t]}`;e=e.replace(RegExp.$1,1===RegExp.$1.length?s:o(s))}return e},resetPostUpdateDate(){const e=document.querySelector(".post-meta-info-container .post-update-date .datetime"),t=new Date(e.dataset.updated).getTime(),o=KEEP.theme_config.post?.datetime_format||"YYYY-MM-DD HH:mm:ss";e.innerHTML=this.formatDatetime(o,t)},enableFullScreen(){const e=document.querySelector(".post-tools-container .full-screen");if(e){const t=e.querySelector("i"),o=()=>document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,s=()=>{o()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen()},n=()=>{o()?(t.classList.remove("fa-expand"),t.classList.add("fa-compress")):(t.classList.remove("fa-compress"),t.classList.add("fa-expand"))};e.addEventListener("click",function(){s()}),document.addEventListener("fullscreenchange",n),document.addEventListener("mozfullscreenchange",n),document.addEventListener("webkitfullscreenchange",n)}}},KEEP.utils.postHelper.initSetPostToolsLeft(),KEEP.utils.postHelper.setArticleAgingDays(),KEEP.utils.postHelper.resetPostUpdateDate(),KEEP.utils.postHelper.enableFullScreen(),!0===KEEP.theme_config.toc?.enable&&KEEP.utils.postHelper.initToggleToc(),!0===KEEP.theme_config.comment?.enable&&(KEEP.utils.postHelper.goToComments(),KEEP.utils.postHelper.watchPostCommentsCount())}!0===KEEP.theme_config.pjax?.enable&&KEEP.utils?initPostHelper():window.addEventListener("DOMContentLoaded",initPostHelper);