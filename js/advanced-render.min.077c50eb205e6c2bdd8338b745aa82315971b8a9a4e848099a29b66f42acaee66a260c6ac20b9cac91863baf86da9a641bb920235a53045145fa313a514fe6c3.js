window.hasMermaidRun=!1,window.hasKaTeXRun=!1,window.mermaidRetryCount=0,window.MAX_MERMAID_RETRY=3,typeof mermaid=="undefined"&&typeof window.mermaid!="undefined"&&(window.mermaid=window.mermaid),window.mermaid&&configMermaid(),document.addEventListener("DOMContentLoaded",function(){setTimeout(initializeMermaid,0),setTimeout(initializeKaTeX,10),setupMutationObserver()}),window.addEventListener("load",function(){!window.hasMermaidRun&&window.mermaid?initializeMermaid():checkForUnrenderedMermaid(),!window.hasKaTeXRun&&window.renderMathInElement&&initializeKaTeX()});function checkForUnrenderedMermaid(){if(!window.mermaid)return;const t=document.querySelectorAll(".mermaid");let e=!1;t.forEach(t=>{!t.querySelector("svg")&&!t.querySelector(".mermaid-error")&&(e=!0)}),e&&window.mermaidRetryCount<window.MAX_MERMAID_RETRY&&(window.mermaidRetryCount++,setTimeout(initializeMermaid,500))}function configMermaid(){if(!window.mermaid)return;window.mermaid.initialize({startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:'ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',flowchart:{curve:"basis",htmlLabels:!0},sequence:{mirrorActors:!1,wrap:!0,rightAngles:!1,boxMargin:10},themeVariables:{primaryColor:"#3b82f6",primaryTextColor:"#ffffff",primaryBorderColor:"#2563eb",lineColor:"#4b5563",secondaryColor:"#f0f9ff",tertiaryColor:"#f3f4f6"}}),document.documentElement.classList.contains("dark")&&window.mermaid.initialize({theme:"dark",themeVariables:{primaryColor:"#3b82f6",primaryTextColor:"#ffffff",primaryBorderColor:"#60a5fa",lineColor:"#94a3b8",secondaryColor:"#1e293b",tertiaryColor:"#334155"}})}function initializeMermaid(){if(!window.mermaid)return;configMermaid(),processMermaidCodeBlocks();try{typeof window.mermaid.run=="function"?window.mermaid.run({querySelector:".mermaid",suppressErrors:!0}).then(()=>{window.hasMermaidRun=!0,addMermaidStyles(),setTimeout(checkAndFixMermaidCharts,500)}).catch(e=>{tryFallbackMermaidRendering()}):typeof window.mermaid.init=="function"&&tryFallbackMermaidRendering()}catch{tryFallbackMermaidRendering()}}function checkAndFixMermaidCharts(){const e=document.querySelectorAll(".mermaid");e.forEach(e=>{const t=e.querySelector("svg");if(t){{const n=t.getBoundingClientRect(),s=e.getBoundingClientRect();if(n.width>s.width||n.height<20){const n=e.closest(".mermaid-container");if(n){n.style.overflowX="auto",e.style.minWidth="fit-content";const s=t.getAttribute("height");s&&(n.style.minHeight=`${parseInt(s)+40}px`)}}}}else e.innerHTML+='<div class="mermaid-error">图表渲染失败</div>',e.style.color="#e53e3e",e.style.border="1px dashed #e53e3e",e.style.padding="1rem"})}function processMermaidCodeBlocks(){document.querySelectorAll("pre code.language-mermaid, pre code.language-merm").forEach(e=>{const t=e.parentElement;if(t&&!t.parentElement.classList.contains("mermaid")){const n=document.createElement("div");n.className="mermaid",n.innerHTML=e.textContent,t.parentElement.insertBefore(n,t),t.style.display="none"}}),document.querySelectorAll("pre code:not(.language-mermaid):not(.language-merm)").forEach(e=>{const t=e.textContent.trim();if(t.startsWith("sequenceDiagram")||t.startsWith("graph ")||t.startsWith("flowchart ")||t.startsWith("gantt")||t.startsWith("classDiagram")||t.startsWith("stateDiagram")||t.startsWith("pie")||t.startsWith("journey")||t.startsWith("erDiagram")||t.startsWith("mindmap")||t.startsWith("timeline")){const n=e.parentElement;if(n&&!n.parentElement.classList.contains("mermaid")){const e=document.createElement("div");e.className="mermaid",e.innerHTML=t,n.parentElement.insertBefore(e,n),n.style.display="none"}}})}function tryFallbackMermaidRendering(){if(!window.mermaid||typeof window.mermaid.init!="function")return;const e=document.querySelectorAll('.mermaid:not([data-processed="true"])');if(e.length>0)try{window.mermaid.init(0[0],e),window.hasMermaidRun=!0,addMermaidStyles(),setTimeout(checkAndFixMermaidCharts,500)}catch{markFailedMermaidDiagrams()}}function addMermaidStyles(e=document){const t=e.querySelectorAll(".mermaid");t.forEach(e=>{if(!e.parentElement.classList.contains("mermaid-container")){const t=document.createElement("div");t.className="mermaid-container",t.style.overflowX="auto",t.style.maxWidth="100%",t.style.margin="1.5rem 0",e.parentNode.insertBefore(t,e),t.appendChild(e)}e.style.minWidth="fit-content",e.style.margin="0 auto",e.style.textAlign="center";const t=e.querySelector("svg");if(t&&(t.style.margin="0 auto",t.style.maxWidth="100%",document.documentElement.classList.contains("dark"))){const e=t.querySelectorAll("text");e.forEach(e=>{const t=e.getAttribute("fill");(t==="#000"||t==="black"||!t)&&e.setAttribute("fill","#e2e8f0")});const n=t.querySelectorAll("path");n.forEach(e=>{const t=e.getAttribute("stroke");(t==="#000"||t==="black")&&e.setAttribute("stroke","#94a3b8")});const s=t.querySelectorAll("rect");s.forEach(e=>{const t=e.getAttribute("fill");(t==="#fff"||t==="white"||t==="#ffffff")&&e.setAttribute("fill","#1e293b")})}})}function markFailedMermaidDiagrams(){document.querySelectorAll('.mermaid:not([data-processed="true"])').forEach(e=>{e.querySelector("svg")||(e.innerHTML+='<div class="mermaid-error">图表渲染失败</div>',e.style.color="#e53e3e",e.style.border="1px dashed #e53e3e",e.style.padding="1rem")})}function initializeKaTeX(){if(!window.renderMathInElement)return;try{window.renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1,errorColor:"#e53e3e",strict:!1}),window.hasKaTeXRun=!0}catch{}}function setupMutationObserver(){if(!window.MutationObserver)return;const e=new MutationObserver(function(e){let t=!1,n=!1;e.forEach(function(e){e.type==="childList"&&e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&(e.classList&&(e.classList.contains("mermaid")||e.querySelector(".mermaid")||e.querySelector("code.language-mermaid")||e.querySelector("code.language-merm"))&&(t=!0),e.textContent&&(e.textContent.includes("$$")||e.textContent.includes("\\(")||e.textContent.includes("\\["))&&(n=!0))})}),t&&window.mermaid&&setTimeout(initializeMermaid,100),n&&window.renderMathInElement&&setTimeout(initializeKaTeX,100)});e.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1})}const themeToggleButton=document.getElementById("theme-toggle");themeToggleButton&&themeToggleButton.addEventListener("click",function(){setTimeout(function(){initializeMermaid()},100)}),setTimeout(function(){checkForUnrenderedMermaid()},2e3)