document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("toc-container"),s=document.getElementById("toc-content"),a=document.getElementById("toc-toggle"),f=document.getElementById("toc-icon"),h=document.getElementById("mobile-toc-toggle"),d=document.getElementById("toc-close"),n=document.getElementById("toc-overlay"),_=document.querySelector(".toc-header"),v=document.querySelector(".article-content");if(!t||!v)return;const o=s.querySelectorAll("a"),r=document.querySelectorAll(".article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6");r.forEach((e,t)=>{e.id||(e.id=`heading-${t}`)});const u={},e=Array.from(r).map(e=>({id:e.id,element:e,position:e.offsetTop,text:e.textContent}));o.forEach(e=>{const t=e.getAttribute("href");if(t&&t.startsWith("#")){const n=t.substring(1);u[n]=e}});function j(){e.forEach(e=>{e.position=e.element.offsetTop})}function c(){return window.scrollY<300}function p(){c()?(f.setAttribute("icon","mdi:arrow-down"),a.setAttribute("aria-label","滚动到底部")):(f.setAttribute("icon","mdi:arrow-up"),a.setAttribute("aria-label","滚动到顶部"))}function g(){c()?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}p(),a.addEventListener("click",function(){g()}),h&&h.addEventListener("click",function(){t.classList.remove("translate-x-full"),n.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),s.scrollTop=0}),d&&d.addEventListener("click",function(){i()}),n&&n.addEventListener("click",function(){i()});function i(){t.classList.add("translate-x-full"),n.classList.add("hidden"),document.body.classList.remove("overflow-hidden")}function b(t){const n=t+150;for(let t=e.length-1;t>=0;t--)if(e[t].position<=n)return e[t];return e.length>0?e[0]:null}function m(){const n=window.scrollY,e=b(n);if(e){const i=e.id;o.forEach(e=>{e.classList.contains("active")&&e.classList.remove("active")});const n=u[i];if(n&&(n.classList.add("active"),window.innerWidth<1024&&t.classList.contains("translate-x-full")===!1)){const e=n.offsetTop,t=s.clientHeight,o=s.scrollTop;if(e<o||e>o+t-40){const n=e-t/3;n>=0&&(s.scrollTop=n)}}}p()}o.forEach(e=>{e.addEventListener("click",function(t){const n=this.getAttribute("href");if(n&&n.startsWith("#")){t.preventDefault();const a=n.substring(1),s=document.getElementById(a);if(s){const t=s.offsetTop-100;window.scrollTo({top:t,behavior:"smooth"}),history.pushState(null,null,n),o.forEach(e=>e.classList.remove("active")),e.classList.add("active"),window.innerWidth<1024&&i()}}})});function l(e,t){let n;return function(){const s=arguments,o=this;n||(e.apply(o,s),n=!0,setTimeout(()=>n=!1,t))}}window.addEventListener("scroll",l(function(){m()},100)),window.addEventListener("resize",l(function(){j(),m(),window.innerWidth<1024&&!t.classList.contains("translate-x-full")&&i(),window.innerWidth>=1024&&(t.classList.remove("translate-x-full"),document.body.classList.remove("overflow-hidden"),n&&n.classList.add("hidden"))},200));function y(){const e=document.createElement("style");e.innerHTML=`
      @supports(padding: max(0px)) {
        .toc-container {
          padding-left: max(1rem, env(safe-area-inset-left));
          padding-right: max(1rem, env(safe-area-inset-right));
        }
        .toc-overlay {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
      }
    `,document.head.appendChild(e)}y()})