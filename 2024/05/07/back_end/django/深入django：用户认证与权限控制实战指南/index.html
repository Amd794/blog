<!DOCTYPE html><html lang=zh-CN,zh-TW,en,default><head><meta charset=utf-8><link href=/images/favicon.ico rel=icon><link rel=apple-touch-icon href=/images/apple-touch-icon.png><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=keywords content=" Auth, Decorators, Permissions, Guardian, RESTAuth, SessionMgmt, MFA, cmdragon, 个人网站, 编程, 技术分享, 学习资源, 前端开发, 后端开发, 全栈开发, 编程语言, 开发者社区"><meta name=description content="cmdragon’s Blog 是一个专注于编程和技术分享的个性化网站，旨在为编程爱好者、学习者和从业者提供全面的前端开发、后端开发以及全栈开发学习资源。在这里，你可以深入了解各种编程语言，探索实用的技术技巧，还能与其他开发者共同交流，助力个人技能提升和职业发展。"><meta name=author content=cmdragon><meta name=baidu-site-verification content=codeva-Q85hVj3vOu><link rel=alternate type=application/atom+xml href=https://blog.cmdragon.cn/atom.xml><link rel=alternate type=application/rss+xml href=https://blog.cmdragon.cn/sitemap.xml><meta property=og:url content=https://blog.cmdragon.cn/2024/05/07/back_end/django/%E6%B7%B1%E5%85%A5django%EF%BC%9A%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/index.html><meta property=og:type content=website><meta property=og:title content="深入Django：用户认证与权限控制实战指南 - cmdragon’s Blog"><meta property=og:description content="深入Django：用户认证与权限控制实战指南, cmdragon’s Blog 是一个专注于编程和技术分享的个性化网站，旨在为编程爱好者、学习者和从业者提供全面的前端开发、后端开发以及全栈开发学习资源。在这里，你可以深入了解各种编程语言，探索实用的技术技巧，还能与其他开发者共同交流，助力个人技能提升和职业发展。"><meta property=og:image content=https://api.btstu.cn/sjbz/api.php><meta name=twitter:card content=https://api.btstu.cn/sjbz/api.php><meta property=twitter:domain content=cmdragon.cn><meta property=twitter:url content=https://blog.cmdragon.cn/2024/05/07/back_end/django/%E6%B7%B1%E5%85%A5django%EF%BC%9A%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/index.html><meta name=twitter:title content="深入Django：用户认证与权限控制实战指南 - cmdragon’s Blog"><meta name=twitter:description content="深入Django：用户认证与权限控制实战指南, cmdragon’s Blog 是一个专注于编程和技术分享的个性化网站，旨在为编程爱好者、学习者和从业者提供全面的前端开发、后端开发以及全栈开发学习资源。在这里，你可以深入了解各种编程语言，探索实用的技术技巧，还能与其他开发者共同交流，助力个人技能提升和职业发展。"><meta name=twitter:image content=https://api.btstu.cn/sjbz/api.php><script type=text/javascript>((t,e,n,a,c,r)=>{t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(c=e.createElement(a)).async=1,c.src="https://www.clarity.ms/tag/mmt9qkvlod",(r=e.getElementsByTagName(a)[0]).parentNode.insertBefore(c,r)})(window,document,"clarity","script")</script><script charset=UTF-8 id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script><script>LA.init({id:"3IdZIMuyj5mvN0Fz",ck:"3IdZIMuyj5mvN0Fz"})</script><meta name=baidu-site-verification content=codeva-1e6idrc8FW><script>(()=>{var e,t,o,r,n=document.getElementsByTagName("link");if(0<n.length)for(i=0;i<n.length;i++)"canonical"==n[i].rel.toLowerCase()&&n[i].href&&(e=n[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,r=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",r?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)})()</script><title>深入Django：用户认证与权限控制实战指南 | cmdragon&#39;s Blog</title><script type=application/ld+json>{
            "@context": "https://schema.org",
            "@type": "NewsArticle",
            "headline": "深入Django：用户认证与权限控制实战指南 - cmdragon’s Blog",
            "image": [
                "https://api.btstu.cn/sjbz/api.php",
                "https://t.alcy.cc/mp/",
                "https://img.xjh.me/random_img.php"
            ],
            "datePublished": "Tue May 07 2024 18:50:33 GMT+0800",
            "dateModified": "Tue May 07 2024 18:50:33 GMT+0800",
            "aggregateRating": {
                "@type": "AggregateRating",
                "itemReviewed": {
                    "type": "Book",
                    "name": "深入Django：用户认证与权限控制实战指南 - cmdragon’s Blog"
                },
                "ratingValue": 9.5,
                "bestRating": "10",
                "ratingCount": 526
            },
            "publisher":
              {
                    "@type": "Person",
                    "name": "cmdragon",
                    "url": "https://github.com/Amd794"
              },
            "author": [
                {
                    "@type": "Person",
                    "name": "cmdragon",
                    "url": "https://cmdragon.cn/"
                },
                {
                    "@type": "Person",
                    "name": "amd794",
                    "url": "https://github.com/Amd794"
                }
            ]
        }</script><script>(()=>{var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)})()</script><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico><link rel=stylesheet href=/font/css/fontawesome.min.css><link rel=stylesheet href=/font/css/regular.min.css><link rel=stylesheet href=/font/css/solid.min.css><link rel=stylesheet href=/font/css/brands.min.css><script class=keep-theme-configurations>let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"blog.cmdragon.cn",root:"/",language:["zh-CN","zh-TW","en","default"],path:"search.json"},KEEP.theme_config={base_info:{primary_color:"#0066cc",title:"cmdragon's Blog",author:"cmdragon",avatar:"/images/avatar.jpg",logo:"/images/logo.svg",favicon:"/images/favicon.ico",apple_touch_icon:"/images/apple-touch-icon.png"},menu:{Home:"/",Archives:"/archives","工具箱":"https://tools.cmdragon.cn",Links:"/links"},first_screen:{enable:!0,background_img:"/images/bg.svg",background_img_dark:"/images/bg.svg",description:"Keep writing and Keep loving.",hitokoto:!0},social_contact:{enable:!0,links:null},scroll:{progress_bar:!0,hide_header:!0},home:{category:!1,tag:!0},post:{author_badge:{enable:!0,level_badge:!1,custom_badge:["炼气","筑基","结丹","元婴","化神","破虚","渡劫","大乘","散仙","真仙","金仙","玄仙","天仙","圣人"]},word_count:{wordcount:!0,min2read:!0},datetime_format:"YYYY-MM-DD HH:mm:ss",copyright_info:!0,share:!0,reward:{enable:!0,img_link:"/images/payment.jpg",text:"打赏作者一包辣条！"}},code_block:{tools:{enable:!0,style:"default"},highlight_theme:"default"},toc:{enable:!0,number:!0,expand_all:!0,init_open:!0,layout:"right"},local_search:{enable:!0,preload:!0},comment:{enable:!1},rss:{enable:!0},lazyload:{enable:!0},cdn:{enable:!1,provider:"cdnjs"},footer:{since:2023,word_count:!1,record:{enable:!1,list:[{code:"粤ICP备2024258322号-2",link:"https://beian.miit.gov.cn"}]},site_deploy:{enable:!0,provider:"github",url:"https://tools.cmdragon.cn/"}},mermaid:{enable:!0,version:"latest"},root:"",source_data:{icons:{"赞赏":{svg:'<svg t="1706412189860" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3855" width="200" height="200"><path d="M984 632.9l-0.2 0.2C953.9 522 885.5 425.4 791.3 360.3c-13.9-9.6-32-10.5-47.8-4.4-150.4 58.7-317.4 58.7-467.7 0-15.8-6.2-33.8-5.2-47.7 4.4C65.4 473.3-12 675.6 35.7 869.7 65 947.3 136.4 1001.2 219 1008.1h594.6c59.8-1.5 115-32.7 147.1-83.2 18-24.9 28.3-54.5 29.8-85.2 15.9-68.3 13.7-139.6-6.5-206.8zM632.4 795h-91.7v61.7c0 16.4-13.3 29.8-29.8 29.8-16.4 0-29.8-13.3-29.8-29.8V795h-91.6c-16.4 0-29.8-13.3-29.8-29.8 0-16.4 13.3-29.8 29.8-29.8h91.6v-61.8h-91.6c-16.4 0-29.8-13.3-29.8-29.8 0-16.4 13.3-29.8 29.8-29.8H447l-68.2-68.2c-8.1-7.5-11.4-18.8-8.7-29.5 2.7-10.7 11.1-19 21.7-21.7 10.7-2.7 22 0.6 29.5 8.7l85.2 85.2 85.2-85.2c11.9-11 30.4-10.7 41.8 0.7 11.5 11.5 11.8 29.9 0.8 41.8L570.4 614h61.7c16.4 0 29.8 13.3 29.8 29.8 0 16.4-13.3 29.8-29.8 29.8h-91.9v61.7h92c16.4 0 29.8 13.3 29.8 29.8 0.2 16.6-13.2 29.9-29.6 29.9z" p-id="3856"></path><path d="M297.6 310.4l0.1-0.2 14.9 14.9c2.5 1.7 5.5 2.4 8.5 2.1 122.8 39.3 254.9 38.3 377.3-2.8 2.1-1.2 4.2-2.3 6.4-3.5 27-22.3 48.2-50.9 61.7-83.2 6.3-14.9 6.3-21.3 12.8-36.2 1-7.5 1.1-13.8 1.4-20.4 0.3-0.7 0.4-1.2 0.7-1.9 6.3-46.9 0-74.5-27.6-95.8-22.9-14.8-49.4-22.9-76.7-23.4-17.9-1.1-35.8 3.4-51.1 12.8h-2c-0.6 0-1.1-0.2-1.5-0.6-0.4-0.4-0.6-0.9-0.6-1.5-29.3-26.3-67.3-40.7-106.6-40.6-38.7-0.5-76.1 14-104.5 40.4-6.3 0-6.3 2.1-8.5 2.1h-2.2c-15.6-6.2-32.3-9.1-49.1-8.5-8.6-0.4-17.2 0.3-25.6 2.1-24.1 1.9-46.4 13.4-62 31.8-14.3 16.9-21.5 38.4-21.1 60.4-2.1 9.2-3.3 18.7-2.4 28.3 6 46.4 26.1 89.5 57.7 123.7z" p-id="3857"></path></svg>',link:"img | /images/payment.jpg"},Wechat:{svg:'<svg t="1718087712961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1061" width="200" height="200"><path d="M26.54814827 512a485.45185173 485.45185173 0 1 1 970.90370346 0A485.45185173 485.45185173 0 0 1 26.54814827 512z m596.86305173-90.41540693c7.16041493 0 14.19946667 0.60681493 21.3598816 1.2136288C625.71709653 334.62802987 530.2651264 269.2740736 421.46322987 269.2740736 299.61481493 269.2740736 199.85445973 351.13339307 199.85445973 455.26281493c0 60.07466667 33.07140693 109.46939307 88.53428054 147.75940694l-22.14874027 65.839408 77.49025173-38.53274134c27.6707552 5.33997013 50.00154027 10.92266667 77.49025174 10.92266667 6.85700693 0 13.77469653-0.2427264 20.63170346-0.97090347a156.19413333 156.19413333 0 0 1-6.79632533-45.6931552c0-95.51265173 83.01226667-173.00290347 188.3553184-173.00290346h-0.0606816z m-119.17842987-59.3464896c16.6267264 0 27.6707552 10.92266667 27.67075627 27.30666666s-11.04402987 27.30666667-27.67075627 27.30666667c-16.74808853 0-33.37481493-10.92266667-33.37481493-27.30666667 0.30340693-16.384 16.93013333-27.30666667 33.37481493-27.30666666z m-155.04118506 54.73469653c-16.68740693 0-33.37481493-10.92266667-33.37481494-27.30666667 0-16.4446816 16.68740693-27.30666667 33.37481494-27.30666666 16.6267264 0 27.6707552 10.86198507 27.6707552 27.30666666 0 16.2019552-10.92266667 27.30666667-27.6707552 27.30666667z m476.28894826 175.0660736c0-87.38133333-88.5342816-158.56071147-188.11259306-158.5607104-105.40373333 0-188.3553184 71.24005973-188.3553184 158.5607104 0 87.68474027 82.95158507 158.6820736 188.3553184 158.68207467 22.08805973 0 44.4188448-5.58269653 66.50690453-10.92266667l60.86352533 32.9500448-16.68740693-54.73469653c44.2974816-32.9500448 77.42957013-76.7620736 77.42957013-125.97475627z m-249.0974816-27.30666667c-11.10471147 0-22.08805973-10.92266667-22.08805866-21.84533333 0-10.86198507 10.98334827-21.72397013 22.08805866-21.72397013 16.68740693 0 27.6707552 10.92266667 27.6707552 21.78465173 0 10.92266667-11.10471147 21.78465173-27.6707552 21.78465173z m121.84841494 0c-11.04402987 0-22.02737813-10.92266667-22.02737814-21.84533333 0-10.86198507 10.98334827-21.72397013 22.08805974-21.72397013 16.5660448 0 27.6707552 10.92266667 27.6707552 21.78465173 0 10.92266667-11.3474368 21.78465173-27.6707552 21.78465173h-0.0606816z" fill="#333333" p-id="1062"></path></svg>',link:"img | /images/wx_qrcode.jpg"}}},version:"4.1.3"},KEEP.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},KEEP.language_code_block={copy:"Copy code",copied:"Copied",fold:"Fold code block",folded:"Folded"},KEEP.language_copy_copyright={copy:"Copy copyright info",copied:"Copied",title:"Original post title",author:"Original post author",link:"Original post link"}</script><meta name=generator content="Hexo 7.3.0"></head><body><div class=progress-bar-container><span class=scroll-progress-bar></span></div><main class="page-container border-box"><div class="page-main-content border-box"><div class=page-main-content-top><header class=header-wrapper><div class="border-box header-content"><div class="left border-box"><a class="logo-image border-box" href=/ ><img src=/images/logo.svg alt=logo> </a><a class="site-name border-box" href=/ >cmdragon&#39;s Blog</a></div><div class="right border-box"><div class=pc><ul class=menu-list><li class=menu-item><a class="" href=/ >首页</a></li><li class=menu-item><a class="" href=/archives>归档</a></li><li class=menu-item><a class="" target=_blank rel=noopener href=https://tools.cmdragon.cn>工具箱</a></li><li class=menu-item><a class="" href=/links>友链</a></li><li class="menu-item search search-popup-trigger"><i class="fas search fa-search"></i></li></ul></div><div class=mobile><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class=menu-bar-middle></div></div></div></div></div><div class=header-drawer><ul class=drawer-menu-list><li class="drawer-menu-item flex-center"><a class="" href=/ >首页</a></li><li class="drawer-menu-item flex-center"><a class="" href=/archives>归档</a></li><li class="drawer-menu-item flex-center"><a class="" target=_blank rel=noopener href=https://tools.cmdragon.cn>工具箱</a></li><li class="drawer-menu-item flex-center"><a class="" href=/links>友链</a></li></ul></div><div class=window-mask></div></header></div><div class="page-main-content-middle border-box"><div class="main-content border-box"><div class=fade-in-down-animation><div class="post-page-container border-box"><div class="post-content-container border-box"><div class="post-content-bottom border-box"><h1 class=post-title>深入Django：用户认证与权限控制实战指南</h1><div class="post-header border-box"><div class="avatar-box border-box"><img src=/images/avatar.jpg alt=avatar></div><div class=info-box><div class="author border-box"><span class=name>cmdragon</span> <span class=author-badge>大乘</span></div><div class="meta-info border-box"><div class="post-meta-info-container border-box post"><div class="post-meta-info border-box"><span class="meta-info-item post-create-date"><i class="icon fa-solid fa-calendar-plus"></i>&nbsp; <span class=datetime>2024-05-07 18:50:33</span> </span><span class="meta-info-item post-update-date"><i class="icon fa-solid fa-file-pen"></i>&nbsp; <span class=datetime data-updated="Tue May 07 2024 10:50:33 GMT+0000">2024-05-07 18:50:33</span> </span><span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;<ul class=post-category-ul><li class=category-item><a href=/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/ >后端开发</a></li></ul></span><span class="post-tag meta-info-item border-box"><ul class=post-tag-ul><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Auth/ >Auth</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Decorators/ >Decorators</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Permissions/ >Permissions</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/Guardian/ >Guardian</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/RESTAuth/ >RESTAuth</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/SessionMgmt/ >SessionMgmt</a></li><li class=tag-item><span class=tag-separator><i class="icon fas fa-hashtag"></i></span><a href=/tags/MFA/ >MFA</a></li></ul></span><span class="meta-info-item post-wordcount"><i class="icon fas fa-file-word"></i>&nbsp;<span>5.6k 字</span> </span><span class="meta-info-item post-min2read"><i class="icon fas fa-clock"></i>&nbsp;<span>23 分钟</span></span></div></div></div></div></div><div class="post-content keep-markdown-body"><img lazyload alt=image data-src="https://static.amd794.com/blog/images/2024_05_07 18_57_50.png@blog" title="2024_05_07 18_57_50.png" alt="2024_05_07 18_57_50.png"><h2 id=第1章：入门Django与设置><a href=#第1章：入门Django与设置 class=headerlink title=第1章：入门Django与设置></a><strong>第1章：入门Django与设置</strong></h2><h3 id=1-1-Django安装与环境配置><a href=#1-1-Django安装与环境配置 class=headerlink title="1.1 Django安装与环境配置"></a><strong>1.1 Django安装与环境配置</strong></h3><p>在开始使用Django之前，需要确保已经安装了Python环境。在安装好Python后，可以使用以下命令安装Django：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>pip install Django</span><br></pre></td></tr></table></figure><p>确保已安装Django后，可以使用以下命令检查版本：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>django-admin --version</span><br></pre></td></tr></table></figure><h3 id=1-2-创建第一个Django项目和应用><a href=#1-2-创建第一个Django项目和应用 class=headerlink title="1.2 创建第一个Django项目和应用"></a><strong>1.2 创建第一个Django项目和应用</strong></h3><p>创建一个新的Django项目：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>django-admin startproject myproject</span><br></pre></td></tr></table></figure><p>进入项目目录：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line><span class=built_in>cd</span> myproject</span><br></pre></td></tr></table></figure><p>创建一个新的Django应用：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>python manage.py startapp myapp</span><br></pre></td></tr></table></figure><h3 id=1-3-设置基础用户模型><a href=#1-3-设置基础用户模型 class=headerlink title="1.3 设置基础用户模型"></a><strong>1.3 设置基础用户模型</strong></h3><p>Django默认提供一个基本的用户模型，如果需要定制用户模型，可以在<code>myproject/settings.py</code>中进行设置。</p><p>例如，可以添加一个新的字段<code>age</code>：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=comment># myproject/settings.py</span></span><br><span class=line></span><br><span class=line>AUTH_USER_MODEL = <span class=string>&#x27;myapp.NewUser&#x27;</span></span><br><span class=line></span><br><span class=line><span class=comment># myapp/models.py</span></span><br><span class=line></span><br><span class=line><span class=keyword>from</span> django.contrib.auth.models <span class=keyword>import</span> AbstractUser</span><br><span class=line><span class=keyword>from</span> django.db <span class=keyword>import</span> models</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">NewUser</span>(<span class="title class_ inherited__">AbstractUser</span>):</span><br><span class=line>    age = models.PositiveIntegerField(null=<span class=literal>True</span>, blank=<span class=literal>True</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__str__</span>(<span class=params>self</span>):</span><br><span class=line>        <span class=keyword>return</span> <span class=string>f&#x27;<span class=subst>&#123;self.username&#125;</span> (<span class=subst>&#123;self.email&#125;</span>)&#x27;</span></span><br></pre></td></tr></table></figure><p>在数据库迁移中应用新的用户模型：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>python manage.py makemigrations</span><br><span class=line>python manage.py migrate</span><br></pre></td></tr></table></figure><p>现在，已经完成了基本的Django项目和应用的创建，并设置了一个基础的用户模型。</p><h2 id=第2章：Django认证系统><a href=#第2章：Django认证系统 class=headerlink title=第2章：Django认证系统></a><strong>第2章：Django认证系统</strong></h2><h3 id=2-1-用户模型详解><a href=#2-1-用户模型详解 class=headerlink title="2.1 用户模型详解"></a><strong>2.1 用户模型详解</strong></h3><p>在Django中，<code>AUTH_USER_MODEL</code>设置决定了你如何处理用户。默认的用户模型是<code>django.contrib.auth.models.User</code><br>，但如你之前设置的，可以创建自定义用户模型。例如，<code>NewUser</code>模型需要继承<code>AbstractUser</code>，并包含<code>username</code>,<code>email</code>, 和<code>age</code>等字段。</p><h3 id=2-2-用户注册、登录与验证><a href=#2-2-用户注册、登录与验证 class=headerlink title="2.2 用户注册、登录与验证"></a><strong>2.2 用户注册、登录与验证</strong></h3><ul><li><strong>注册</strong>：Django的<code>UserCreationForm</code>和<code>UserChangeForm</code>可以用于用户注册，通常在<code>myapp/forms.py</code>中定义。在<code>views.py</code><br>中使用<code>UserCreationForm.as_view()</code>创建视图。</li></ul><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib.auth <span class=keyword>import</span> get_user_model</span><br><span class=line><span class=keyword>from</span> django.urls <span class=keyword>import</span> reverse_lazy</span><br><span class=line><span class=keyword>from</span> django.views <span class=keyword>import</span> generic</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">RegisterView</span>(generic.CreateView):</span><br><span class=line>    form_class = get_user_model().forms.UserCreationForm</span><br><span class=line>    success_url = reverse_lazy(<span class=string>&#x27;login&#x27;</span>)</span><br><span class=line>    template_name = <span class=string>&#x27;registration/register.html&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><strong>登录</strong>：<code>LoginView</code>和<code>LogoutView</code>在<code>django.contrib.auth.views</code>中，使用<code>LoginView.as_view()</code>和<code>LogoutView.as_view()</code>。</li></ul><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib.auth.views <span class=keyword>import</span> LoginView, LogoutView</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">CustomLoginView</span>(<span class="title class_ inherited__">LoginView</span>):</span><br><span class=line>    template_name = <span class=string>&#x27;registration/login.html&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><strong>验证</strong>：用户登录后，Django会自动验证用户。在<code>views.py</code>中，你可以使用<code>@login_required</code>装饰器确保只有登录用户才能访问某些视图。</li></ul><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib.auth.decorators <span class=keyword>import</span> login_required</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=meta>@login_required</span></span><br><span class=line><span class=keyword>def</span> <span class="title function_">protected_view</span>(<span class=params>request</span>):</span><br><span class=line>    <span class=comment># 只有已登录用户可以访问的视图</span></span><br><span class=line>    ...</span><br></pre></td></tr></table></figure><h3 id=2-3-自定义认证视图和URL><a href=#2-3-自定义认证视图和URL class=headerlink title="2.3 自定义认证视图和URL"></a><strong>2.3 自定义认证视图和URL</strong></h3><p>要自定义登录或注册视图，可以创建一个类视图并定义<code>get</code>和<code>post</code>方法。在<code>urls.py</code>中，使用<code>path</code>来映射URL到这些视图。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.urls <span class=keyword>import</span> path</span><br><span class=line></span><br><span class=line><span class=keyword>from</span> .views <span class=keyword>import</span> CustomLoginView, CustomRegisterView</span><br><span class=line></span><br><span class=line>urlpatterns = [</span><br><span class=line>    path(<span class=string>&#x27;login/&#x27;</span>, CustomLoginView.as_view(), name=<span class=string>&#x27;login&#x27;</span>),</span><br><span class=line>    path(<span class=string>&#x27;register/&#x27;</span>, CustomRegisterView.as_view(), name=<span class=string>&#x27;register&#x27;</span>),</span><br><span class=line>]</span><br></pre></td></tr></table></figure><h3 id=2-4-CSRF保护><a href=#2-4-CSRF保护 class=headerlink title="2.4 CSRF保护"></a><strong>2.4 CSRF保护</strong></h3><p>Django的CSRF（跨站请求伪造）保护是通过在表单中添加一个隐藏的CSRF<br>token来实现的。确保在所有需要用户交互的表单（如注册和登录表单）中使用<code>&#123;% csrf_token %&#125;</code>模板标签。</p><p>此外，你可以在<code>settings.py</code>中启用CSRF保护：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>CSRF_COOKIE_NAME = <span class=string>&#x27;my_custom_cookie_name&#x27;</span></span><br><span class=line>CSRF_COOKIE_SECURE = <span class=literal>True</span></span><br><span class=line>CSRF_COOKIE_HTTPONLY = <span class=literal>True</span></span><br></pre></td></tr></table></figure><p>这将确保CSRF令牌的安全传输。</p><h2 id=第3章：认证中间件和信号><a href=#第3章：认证中间件和信号 class=headerlink title=第3章：认证中间件和信号></a><strong>第3章：认证中间件和信号</strong></h2><h3 id=3-1-中间件在认证中的作用><a href=#3-1-中间件在认证中的作用 class=headerlink title="3.1 中间件在认证中的作用"></a><strong>3.1 中间件在认证中的作用</strong></h3><p><strong>认证中间件</strong></p><p>AD：<a class=link target=_blank rel=noopener href=https://amd794.com/ >首页 | 一个覆盖广泛主题工具的高效在线平台<i class="fas fa-external-link-alt"></i></a><br>是Django提供的一种处理请求和响应的机制，它位于视图函数之前和之后。在认证中，<code>django.contrib.auth.middleware.AuthenticationMiddleware</code><br>负责检测请求是否已通过身份验证。如果用户未登录，中间件会重定向到登录页面。一旦用户登录，中间件会设置<code>request.user</code><br>，使得视图可以访问用户信息。</p><h3 id=3-2-用户登录状态管理><a href=#3-2-用户登录状态管理 class=headerlink title="3.2 用户登录状态管理"></a><strong>3.2 用户登录状态管理</strong></h3><p>Django的认证系统会在用户登录后自动设置<code>request.user</code>，这使得在视图中可以通过<code>request.user</code><br>访问用户信息。但如果你想在会话之外存储用户状态（例如，记住用户名），可以使用<br>AD：<a class=link target=_blank rel=noopener href=https://movie.amd794.com:2083/ >专业搜索引擎<i class="fas fa-external-link-alt"></i></a><br><code>django.contrib.auth.middleware.SessionAuthenticationMiddleware</code><br>，它会将用户信息存储在会话中。如果需要自定义登录状态的持久性，可以考虑使用<code>django.contrib.auth.backends.RemoteUserBackend</code><br>或创建自己的<code>Backend</code>实现。</p><h3 id=3-3-认证信号与事件处理><a href=#3-3-认证信号与事件处理 class=headerlink title="3.3 认证信号与事件处理"></a><strong>3.3 认证信号与事件处理</strong></h3><p><strong>认证信号</strong>是Django的一种通知机制，用于在认证过程中触发特定事件。例如，<code>user_logged_in</code>和<code>user_logged_out</code><br>信号分别在用户登录和登出时发送。你可以通过注册接收器来处理这些信号，执行额外的操作，如发送邮件通知或更新用户会话记录。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib.auth <span class=keyword>import</span> get_user_model</span><br><span class=line><span class=keyword>from</span> django.dispatch <span class=keyword>import</span> receiver</span><br><span class=line><span class=keyword>from</span> django.db.models.signals <span class=keyword>import</span> post_save</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment># 注册接收器</span></span><br><span class=line><span class=meta>@receiver(<span class=params>post_save, sender=get_user_model(<span class=params></span>)</span>)</span></span><br><span class=line><span class=keyword>def</span> <span class="title function_">create_or_update_user_profile</span>(<span class=params>sender, instance, created, **kwargs</span>):</span><br><span class=line>    <span class=keyword>if</span> created:</span><br><span class=line>    <span class=comment># 用户创建时，创建用户profile</span></span><br><span class=line>    <span class=keyword>else</span>:</span><br><span class=line><span class=comment># 用户更新时，更新userprofile</span></span><br></pre></td></tr></table></figure><p>通过这种方式，你可以扩展Django认证系统的功能，而无需直接修改核心代码。</p><h2 id=第4章：权限系统基础><a href=#第4章：权限系统基础 class=headerlink title=第4章：权限系统基础></a><strong>第4章：权限系统基础</strong></h2><h3 id=4-1-Django内置权限模型><a href=#4-1-Django内置权限模型 class=headerlink title="4.1 Django内置权限模型"></a><strong>4.1 Django内置权限模型</strong></h3><p>Django的权限系统主要依赖于<code>django.contrib.auth.models</code>模块中的以下几个模型：</p><ul><li><code>User</code>：表示用户，每个用户都有一个唯一的用户名和密码。</li><li><code>Group</code>：用于组织用户，一个用户可以属于多个组。</li><li><code>Permission</code>：表示一个操作或资源的权限，例如“管理博客”或“查看文章”。</li><li><code>UserPermission</code>（也称为<code>user_has_perm</code>）：关联用户和权限，表示用户拥有特定的权限。</li></ul><h3 id=4-2-用户角色与权限关联><a href=#4-2-用户角色与权限关联 class=headerlink title="4.2 用户角色与权限关联"></a><strong>4.2 用户角色与权限关联</strong></h3><p>在Django中，用户和权限通常是通过<code>Group</code><br>来关联的。用户可以被添加到一个或多个组中，而组则被赋予了特定的权限。这样，如果一个用户属于某个具有特定权限的组，那么该用户就自动获得了该组的所有权限。通过这种方式，可以实现角色（如管理员、编辑员等）的权限管理。</p><h3 id=4-3-分组与权限管理><a href=#4-3-分组与权限管理 class=headerlink title="4.3 分组与权限管理"></a><strong>4.3 分组与权限管理</strong></h3><ul><li><strong>创建和管理组</strong>：使用<code>Group</code>模型，你可以创建新的组，然后将用户添加到组中。例如：</li></ul><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>group = Group.objects.create(name=<span class=string>&#x27;Administrators&#x27;</span>)</span><br><span class=line>user = User.objects.get(username=<span class=string>&#x27;john&#x27;</span>)</span><br><span class=line>group.user_set.add(user)</span><br></pre></td></tr></table></figure><ul><li><strong>为组分配权限</strong>：使用<code>Permission</code>模型，为组赋予特定的权限，然后将组与这些权限关联起来。例如：</li></ul><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>permission = Permission.objects.get(codename=<span class=string>&#x27;add_article&#x27;</span>)</span><br><span class=line>group.permissions.add(permission)</span><br></pre></td></tr></table></figure><ul><li><strong>检查用户权限</strong>：在视图中，可以使用<code>user.has_perm()</code>或<code>user.has_module_perms()</code>方法检查用户是否具有特定的权限。</li></ul><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>if</span> request.user.has_perm(<span class=string>&#x27;blog.add_article&#x27;</span>):</span><br><span class=line><span class=comment># 用户有添加文章的权限</span></span><br></pre></td></tr></table></figure><p>通过这种方式，Django的权限系统允许你以灵活的方式管理用户对应用的不同部分的访问。</p><h2 id=第5章：自定义权限和验证><a href=#第5章：自定义权限和验证 class=headerlink title=第5章：自定义权限和验证></a><strong>第5章：自定义权限和验证</strong></h2><h3 id=5-1-使用-permission-required装饰器><a href=#5-1-使用-permission-required装饰器 class=headerlink title="5.1 使用@permission_required装饰器"></a><strong>5.1 使用@permission_required装饰器</strong></h3><p>Django提供了一个名为<code>@permission_required</code>的装饰器，用于在视图函数中检查用户是否具有特定权限。例如：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib.auth.decorators <span class=keyword>import</span> permission_required</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>def</span> <span class="title function_">some_view</span>(<span class=params>request</span>):</span><br><span class=line><span class=meta>    @permission_required(<span class=params><span class=string>&#x27;blog.add_article&#x27;</span></span>)</span></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">inner_view</span>(<span class=params>request</span>):</span><br><span class=line>        <span class=comment># 视图代码，如果用户没有添加文章的权限，将被重定向到登录页面</span></span><br><span class=line>        ...</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> inner_view(request)</span><br></pre></td></tr></table></figure><p>如果用户没有<code>blog.add_article</code>权限，请求会重定向到登录页面，或者根据设置显示一个403 Forbidden错误。</p><h3 id=5-2-编写自定义权限类><a href=#5-2-编写自定义权限类 class=headerlink title="5.2 编写自定义权限类"></a><strong>5.2 编写自定义权限类</strong></h3><p>Django允许你自定义权限类来实现更复杂的权限检查。创建一个继承自<code>BasePermission</code>的类，然后在<code>has_permission</code>方法中定义你的逻辑：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib.auth.models <span class=keyword>import</span> Permission</span><br><span class=line><span class=keyword>from</span> django.contrib.auth.base_permissions <span class=keyword>import</span> BasePermission</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">IsSuperAdmin</span>(<span class="title class_ inherited__">BasePermission</span>):</span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">has_permission</span>(<span class=params>self, request, view</span>):</span><br><span class=line>        <span class=comment># 检查用户是否是超级管理员</span></span><br><span class=line>        <span class=keyword>return</span> request.user.is_superuser</span><br></pre></td></tr></table></figure><p>然后在视图中使用这个自定义权限：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>def</span> <span class="title function_">some_view</span>(<span class=params>request</span>):</span><br><span class=line>    permission_classes = (IsSuperAdmin,)</span><br><span class=line>    <span class=comment># 使用自定义权限检查</span></span><br><span class=line>    <span class=keyword>if</span> <span class=keyword>not</span> request.user.has_perm(IsSuperAdmin()):</span><br><span class=line>        <span class=keyword>return</span> HttpResponseForbidden(<span class=string>&#x27;You are not authorized.&#x27;</span>)</span><br><span class=line>    ...</span><br></pre></td></tr></table></figure><h3 id=5-3-权限验证最佳实践><a href=#5-3-权限验证最佳实践 class=headerlink title="5.3 权限验证最佳实践"></a><strong>5.3 权限验证最佳实践</strong></h3><ul><li><strong>避免硬编码</strong>：不要在代码中硬编码用户的权限检查，而应使用Django的权限系统。</li><li><strong>使用装饰器</strong>：<code>@permission_required</code>装饰器是快速添加权限检查的好工具，但也要注意不要过度使用，可能导致代码难以理解和维护。</li><li><strong>权限分离</strong>：将权限管理与业务逻辑分离，确保权限检查独立于具体的视图。</li><li><strong>使用权限类</strong>：自定义权限类可以提供更灵活的权限控制，例如基于角色、用户组或用户属性的权限。</li><li><strong>错误处理</strong>：对于权限检查失败的情况，提供清晰的错误信息和适当的用户反馈，如重定向到登录页面或显示一个友好的错误消息。</li></ul><p>AD：<a class=link target=_blank rel=noopener href=https://comic.amd794.com:2087/ >漫画首页<i class="fas fa-external-link-alt"></i></a><br>遵循这些最佳实践，可以确保你的权限系统既安全又易于管理。</p><h2 id=第6章：权限管理框架（如django-guardian）><a href=#第6章：权限管理框架（如django-guardian） class=headerlink title=第6章：权限管理框架（如django-guardian）></a><strong>第6章：权限管理框架（如django-guardian）</strong></h2><h3 id=6-1-django-guardian的介绍><a href=#6-1-django-guardian的介绍 class=headerlink title="6.1 django-guardian的介绍"></a><strong>6.1 django-guardian的介绍</strong></h3><p>django-guardian是一个Django应用，用于在Django项目中实现更细粒度的权限控制。django-guardian允许你将权限授予单个对象，而不仅仅是对整个模型的访问权限。</p><h3 id=6-2-细化权限控制><a href=#6-2-细化权限控制 class=headerlink title="6.2 细化权限控制"></a><strong>6.2 细化权限控制</strong></h3><p>django-guardian为你提供了一种在Django中实现更细粒度的权限控制的方法。django-guardian的核心是<code>ObjectPermission</code><br>模型，用于将权限与单个对象关联。</p><p>django-guardian允许你：</p><ul><li>为单个对象设置和管理权限。</li><li>对对象进行精细的权限控制。</li><li>在视图中进行简单的权限检查。</li></ul><h3 id=6-3-实例演示><a href=#6-3-实例演示 class=headerlink title="6.3 实例演示"></a><strong>6.3 实例演示</strong></h3><p>首先，安装django-guardian：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>pip install django-guardian</span><br></pre></td></tr></table></figure><p>在你的Django项目中，添加<code>&#39;guardian&#39;</code>到<code>INSTALLED_APPS</code>中，并在<code>MIDDLEWARE</code><br>中添加<code>&#39;guardian.middleware.UpdatePermissionsMiddleware&#39;</code>。</p><p>接下来，让我们创建一个简单的应用，并在其中使用django-guardian：</p><ol><li><p>创建一个名为<code>articles</code>的应用：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>python manage.py startapp articles</span><br></pre></td></tr></table></figure></li><li><p>在<code>articles</code>应用中，创建一个名为<code>models.py</code>的文件，并添加以下代码：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.db <span class=keyword>import</span> models</span><br><span class=line><span class=keyword>from</span> django.contrib.auth.models <span class=keyword>import</span> User</span><br><span class=line><span class=keyword>from</span> guardian.shortcuts <span class=keyword>import</span> assign_perm, get_objects_for_user</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">Article</span>(models.Model):</span><br><span class=line>    title = models.CharField(max_length=<span class=number>100</span>)</span><br><span class=line>    content = models.TextField()</span><br><span class=line>    author = models.ForeignKey(User, on_delete=models.CASCADE)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">__str__</span>(<span class=params>self</span>):</span><br><span class=line>        <span class=keyword>return</span> <span class="variable language_">self</span>.title</span><br></pre></td></tr></table></figure></li><li><p>在<code>articles</code>应用中，创建一个名为<code>views.py</code>的文件，并添加以下代码：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.shortcuts <span class=keyword>import</span> render, get_object_or_404</span><br><span class=line><span class=keyword>from</span> django.contrib.auth.decorators <span class=keyword>import</span> login_required</span><br><span class=line><span class=keyword>from</span> django.http <span class=keyword>import</span> HttpResponseForbidden</span><br><span class=line><span class=keyword>from</span> articles.models <span class=keyword>import</span> Article, assign_perm, get_objects_for_user</span><br><span class=line></span><br><span class=line><span class=meta>@login_required</span></span><br><span class=line><span class=keyword>def</span> <span class="title function_">article_list</span>(<span class=params>request</span>):</span><br><span class=line>    user = request.user</span><br><span class=line>    articles = get_objects_for_user(user, <span class=string>&#x27;articles.view_article&#x27;</span>, klass=Article)</span><br><span class=line>    <span class=keyword>return</span> render(request, <span class=string>&#x27;articles/article_list.html&#x27;</span>, &#123;<span class=string>&#x27;articles&#x27;</span>: articles&#125;)</span><br><span class=line></span><br><span class=line><span class=meta>@login_required</span></span><br><span class=line><span class=keyword>def</span> <span class="title function_">assign_article_permissions</span>(<span class=params>request, article_id</span>):</span><br><span class=line>    user = request.user</span><br><span class=line>    article = get_object_or_404(Article, <span class=built_in>id</span>=article_id)</span><br><span class=line>    <span class=keyword>if</span> request.method == <span class=string>&#x27;POST&#x27;</span>:</span><br><span class=line>        <span class=keyword>if</span> user.has_perm(<span class=string>&#x27;articles.change_article&#x27;</span>, article):</span><br><span class=line>            assign_perm(<span class=string>&#x27;articles.view_article&#x27;</span>, user, article)</span><br><span class=line>            <span class=keyword>return</span> HttpResponse(<span class=string>&#x27;Assigned view permission.&#x27;</span>)</span><br><span class=line>        <span class=keyword>else</span>:</span><br><span class=line>            <span class=keyword>return</span> HttpResponseForbidden(<span class=string>&#x27;You do not have the permission to change article.&#x27;</span>)</span><br><span class=line>    <span class=keyword>return</span> render(request, <span class=string>&#x27;articles/assign_permissions.html&#x27;</span>, &#123;<span class=string>&#x27;article&#x27;</span>: article&#125;)</span><br></pre></td></tr></table></figure></li><li><p>在<code>articles</code>应用中，创建一个名为<code>templates/articles</code>的文件夹，并在其中创建一个名为<code>assign_permissions.html</code>的文件：</p><figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>form</span> <span class=attr>method</span>=<span class=string>&quot;post&quot;</span>&gt;</span></span><br><span class=line>    &#123;% csrf_token %&#125;</span><br><span class=line>    <span class=tag>&lt;<span class=name>input</span> <span class=attr>type</span>=<span class=string>&quot;submit&quot;</span> <span class=attr>value</span>=<span class=string>&quot;Assign Permission&quot;</span>&gt;</span></span><br><span class=line><span class=tag>&lt;/<span class=name>form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在<code>articles</code>应用中，创建一个名为<code>urls.py</code>的文件，并添加以下代码：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.urls <span class=keyword>import</span> path</span><br><span class=line><span class=keyword>from</span> . <span class=keyword>import</span> views</span><br><span class=line></span><br><span class=line>urlpatterns = [</span><br><span class=line>    path(<span class=string>&#x27;&#x27;</span>, views.article_list, name=<span class=string>&#x27;article_list&#x27;</span>),</span><br><span class=line>    path(<span class=string>&#x27;assign_permissions/&lt;int:article_id&gt;/&#x27;</span>, views.assign_article_permissions, name=<span class=string>&#x27;assign_permissions&#x27;</span>),</span><br><span class=line>]</span><br></pre></td></tr></table></figure></li><li><p>在你的项目中，将<code>articles</code>应用的<code>urls.py</code>添加到主<code>urls.py</code>中：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib <span class=keyword>import</span> admin</span><br><span class=line><span class=keyword>from</span> django.urls <span class=keyword>import</span> path, include</span><br><span class=line></span><br><span class=line>urlpatterns = [</span><br><span class=line>    path(<span class=string>&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class=line>    path(<span class=string>&#x27;articles/&#x27;</span>, include(<span class=string>&#x27;articles.urls&#x27;</span>)),</span><br><span class=line>]</span><br></pre></td></tr></table></figure></li></ol><p>现在，你可以运行你的项目，并在文章列表中查看权限管理的实例。在这个例子中，我们使用django-guardian为每个用户分配了对文章的特定视图权限。</p><p>你可以使用django-guardian的<code>assign_perm</code>和<code>get_objects_for_user</code><br>函数来分配和检查权限。在这个例子中，我们使用了一个名为<code>view_article</code>的权限，可以在<code>admin.py</code>中进行定义：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.contrib <span class=keyword>import</span> admin</span><br><span class=line><span class=keyword>from</span> django.contrib.auth.models <span class=keyword>import</span> Permission</span><br><span class=line><span class=keyword>from</span> articles.models <span class=keyword>import</span> Article</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">ArticleAdmin</span>(admin.ModelAdmin):</span><br><span class=line>    list_display = (<span class=string>&#x27;title&#x27;</span>, <span class=string>&#x27;author&#x27;</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">save_model</span>(<span class=params>self, request, obj, form, change</span>):</span><br><span class=line>        <span class=keyword>if</span> <span class=keyword>not</span> obj.pk:</span><br><span class=line>            assign_perm(<span class=string>&#x27;articles.view_article&#x27;</span>, request.user, obj)</span><br><span class=line>        obj.save()</span><br><span class=line></span><br><span class=line></span><br><span class=line>admin.site.register(Article, ArticleAdmin)</span><br></pre></td></tr></table></figure><p>这样，当你在Django管理界面中创建一个新文章时，将自动为当前用户分配<code>view_article</code>权限。</p><p>django-guardian为你提供了一种更细粒度的权限控制方法，可以在Django项目中实现更强大的权限管理。</p><h2 id=第7章：视图和模板的权限控制><a href=#第7章：视图和模板的权限控制 class=headerlink title=第7章：视图和模板的权限控制></a><strong>第7章：视图和模板的权限控制</strong></h2><h3 id=7-1-在视图中检查权限><a href=#7-1-在视图中检查权限 class=headerlink title="7.1 在视图中检查权限"></a><strong>7.1 在视图中检查权限</strong></h3><p>在Django中，视图是处理HTTP请求的函数或类。为了在视图中检查用户的权限，可以使用<code>django-guardian</code>提供的<code>has_perm</code><br>和<code>get_objects_for_user</code>函数。以下是一个基本的视图检查权限的例子：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> django.shortcuts <span class=keyword>import</span> render, redirect</span><br><span class=line><span class=keyword>from</span> django.contrib.auth.decorators <span class=keyword>import</span> login_required</span><br><span class=line><span class=keyword>from</span> guardian.shortcuts <span class=keyword>import</span> has_perm</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=meta>@login_required</span></span><br><span class=line><span class=keyword>def</span> <span class="title function_">some_view</span>(<span class=params>request</span>):</span><br><span class=line>    user = request.user</span><br><span class=line>    article = Article.objects.get(pk=<span class=number>1</span>)  <span class=comment># 假设你有一个名为Article的模型</span></span><br><span class=line></span><br><span class=line>    <span class=comment># 检查用户是否有查看文章的权限</span></span><br><span class=line>    <span class=keyword>if</span> <span class=keyword>not</span> has_perm(<span class=string>&#x27;articles.view_article&#x27;</span>, article, user):</span><br><span class=line>        <span class=keyword>return</span> HttpResponseForbidden(<span class=string>&quot;You don&#x27;t have permission to view this article.&quot;</span>)</span><br><span class=line></span><br><span class=line>    <span class=comment># 如果用户有权限，继续执行</span></span><br><span class=line>    <span class=comment># ...</span></span><br><span class=line>    <span class=keyword>return</span> render(request, <span class=string>&#x27;some_template.html&#x27;</span>, &#123;<span class=string>&#x27;article&#x27;</span>: article&#125;)</span><br></pre></td></tr></table></figure><p>在这个例子中，<code>has_perm</code>函数检查用户是否有指定的权限（在这个例子中是<code>articles.view_article</code>）对给定的对象（<code>article</code>）。</p><h3 id=7-2-在模板中显示权限相关信息><a href=#7-2-在模板中显示权限相关信息 class=headerlink title="7.2 在模板中显示权限相关信息"></a><strong>7.2 在模板中显示权限相关信息</strong></h3><p>在模板中，你可能想要显示用户是否具有特定的权限。Django模板语言允许你使用条件语句来检查这些权限。以下是一个简单的例子：</p><figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>&#123;% if user.has_perm(&#x27;articles.view_article&#x27;, article) %&#125;</span><br><span class=line><span class=tag>&lt;<span class=name>p</span>&gt;</span>You have permission to view this article.<span class=tag>&lt;/<span class=name>p</span>&gt;</span></span><br><span class=line>&#123;% else %&#125;</span><br><span class=line><span class=tag>&lt;<span class=name>p</span>&gt;</span>You do not have permission to view this article.<span class=tag>&lt;/<span class=name>p</span>&gt;</span></span><br><span class=line>&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>在这个模板片段中，如果用户具有<code>articles.view_article</code>权限，<code>has_perm</code>表达式会返回<code>True</code>，否则返回<code>False</code>，从而决定显示不同的内容。</p><p>你也可以在模板中使用<code>get_objects_for_user</code>来获取用户具有特定权限的对象，并根据这些对象的内容进行渲染：</p><figure class="highlight html"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre></td><td class=code><pre><span class=line>&#123;% if object_list %&#125;</span><br><span class=line><span class=tag>&lt;<span class=name>ul</span>&gt;</span></span><br><span class=line>    &#123;% for object in object_list %&#125;</span><br><span class=line>    &#123;% if user.has_perm(&#x27;articles.view&#x27;, object) %&#125;</span><br><span class=line>    <span class=tag>&lt;<span class=name>li</span>&gt;</span>&#123;&#123; object.title &#125;&#125; (You can view)<span class=tag>&lt;/<span class=name>li</span>&gt;</span></span><br><span class=line>    &#123;% else %&#125;</span><br><span class=line>    <span class=tag>&lt;<span class=name>li</span>&gt;</span>&#123;&#123; object.title &#125;&#125; (You cannot view)<span class=tag>&lt;/<span class=name>li</span>&gt;</span></span><br><span class=line>    &#123;% endif %&#125;</span><br><span class=line>    &#123;% endfor %&#125;</span><br><span class=line><span class=tag>&lt;/<span class=name>ul</span>&gt;</span></span><br><span class=line>&#123;% else %&#125;</span><br><span class=line><span class=tag>&lt;<span class=name>p</span>&gt;</span>No objects found.<span class=tag>&lt;/<span class=name>p</span>&gt;</span></span><br><span class=line>&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>这样，模板会根据用户的权限动态地显示内容，提供一个用户友好的界面。</p><h2 id=第8章：RESTful-API的认证与权限><a href=#第8章：RESTful-API的认证与权限 class=headerlink title="第8章：RESTful API的认证与权限"></a><strong>第8章：RESTful API的认证与权限</strong></h2><h3 id=8-1-Django-REST-framework的认证集成><a href=#8-1-Django-REST-framework的认证集成 class=headerlink title="8.1 Django REST framework的认证集成"></a><strong>8.1 Django REST framework的认证集成</strong></h3><p>Django REST<br>framework提供了多种认证方式，包括基本认证（BasicAuthentication）、令牌认证（TokenAuthentication）和会话认证（SessionAuthentication）等。可以在项目的设置文件中进行配置。以下是一个基本的认证配置示例：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=comment># settings.py</span></span><br><span class=line></span><br><span class=line>REST_FRAMEWORK = &#123;</span><br><span class=line>    <span class=string>&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class=line>        <span class=string>&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,</span><br><span class=line>        <span class=string>&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,</span><br><span class=line>    )</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>在这个配置中，REST framework将使用基本认证和会话认证来处理API请求。</p><h3 id=8-2-API权限控制策略><a href=#8-2-API权限控制策略 class=headerlink title="8.2 API权限控制策略"></a><strong>8.2 API权限控制策略</strong></h3><p>API权限控制是确保API的安全性和保护数据的重要部分。Django REST<br>framework提供了多种权限控制策略，包括只读权限（ReadOnly）、对象级权限（ObjectPermissions）和自定义权限类（CustomPermission）等。可以在视图中配置权限控制策略。以下是一个使用对象级权限的视图示例：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> rest_framework <span class=keyword>import</span> viewsets, permissions</span><br><span class=line></span><br><span class=line><span class=keyword>from</span> myapp.models <span class=keyword>import</span> Article</span><br><span class=line><span class=keyword>from</span> myapp.serializers <span class=keyword>import</span> ArticleSerializer</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">ArticleViewSet</span>(viewsets.ModelViewSet):</span><br><span class=line>    queryset = Article.objects.<span class=built_in>all</span>()</span><br><span class=line>    serializer_class = ArticleSerializer</span><br><span class=line>    permission_classes = [permissions.DjangoModelPermissions]</span><br></pre></td></tr></table></figure><p>在这个视图中，我们使用了DjangoModelPermissions，这意味着用户只能访问他们拥有的对象。如果用户试图访问他们不拥有的对象，REST<br>framework将返回一个403 Forbidden响应。</p><p>如果你需要更细粒度的权限控制，可以使用自定义权限类。以下是一个简单的自定义权限类示例：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>from</span> rest_framework <span class=keyword>import</span> permissions</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">CustomPermission</span>(permissions.BasePermission):</span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">has_object_permission</span>(<span class=params>self, request, view, obj</span>):</span><br><span class=line>        <span class=keyword>if</span> request.user.is_staff:</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>True</span></span><br><span class=line>        <span class=keyword>return</span> <span class=literal>False</span></span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">ArticleViewSet</span>(viewsets.ModelViewSet):</span><br><span class=line>    queryset = Article.objects.<span class=built_in>all</span>()</span><br><span class=line>    serializer_class = ArticleSerializer</span><br><span class=line>    permission_classes = [CustomPermission]</span><br></pre></td></tr></table></figure><p>在这个示例中，我们创建了一个名为CustomPermission的自定义权限类，它只允许管理员用户访问API。如果用户不是管理员，则返回一个403<br>Forbidden响应。</p><p>总之，Django REST framework为RESTful API的认证和权限控制提供了多种方式和工具，可以根据项目需求进行选择和定制。</p><h2 id=第9章：高级主题><a href=#第9章：高级主题 class=headerlink title=第9章：高级主题></a><strong>第9章：高级主题</strong></h2><h3 id=9-1-用户会话管理><a href=#9-1-用户会话管理 class=headerlink title="9.1 用户会话管理"></a><strong>9.1 用户会话管理</strong></h3><p>在Web应用程序中，用户会话管理是非常重要的，它涉及到用户登录、注销和会话状态的管理。Django提供了内置的会话管理功能，而Django<br>REST framework也提供了相应的支持。通过使用SessionAuthentication认证类，Django REST framework可以与Django的会话管理系统集成，从而实现用户会话管理。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=comment># settings.py</span></span><br><span class=line></span><br><span class=line>REST_FRAMEWORK = &#123;</span><br><span class=line>    <span class=string>&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class=line>        <span class=string>&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,</span><br><span class=line>    )</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>通过将SessionAuthentication添加到DEFAULT_AUTHENTICATION_CLASSES中，可以启用基于会话的认证，从而实现用户会话管理。</p><h3 id=9-2-客户端认证（OAuth2、JWT等）><a href=#9-2-客户端认证（OAuth2、JWT等） class=headerlink title="9.2 客户端认证（OAuth2、JWT等）"></a><strong>9.2 客户端认证（OAuth2、JWT等）</strong></h3><p>客户端认证是指在API请求中对客户端进行身份验证的过程。Django REST framework支持多种客户端认证方式，包括OAuth2和JWT（JSON Web<br>Token）等。这些认证方式可以通过第三方库来实现，比如<code>djangorestframework-simplejwt</code>用于JWT认证。</p><p>以下是一个简单的JWT认证配置示例：</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=comment># settings.py</span></span><br><span class=line></span><br><span class=line>REST_FRAMEWORK = &#123;</span><br><span class=line>    <span class=string>&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class=line>        <span class=string>&#x27;rest_framework_simplejwt.authentication.JWTAuthentication&#x27;</span>,</span><br><span class=line>    )</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>通过将JWTAuthentication添加到DEFAULT_AUTHENTICATION_CLASSES中，可以启用JWT认证，从而实现客户端认证。</p><h3 id=9-3-多因素认证（MFA）><a href=#9-3-多因素认证（MFA） class=headerlink title="9.3 多因素认证（MFA）"></a><strong>9.3 多因素认证（MFA）</strong></h3><p>多因素认证是指在用户登录或进行敏感操作时，除了用户名和密码外，还需要提供第二种或多种身份验证因素的过程。Django REST<br>framework本身并没有内置的多因素认证功能，但可以通过结合第三方库来实现。例如，可以使用<code>django-mfa</code>等库来实现多因素认证功能。</p><p>通过使用这些第三方库，可以实现诸如短信验证码、一次性密码（OTP）等多因素认证方式，从而提高系统的安全性。</p><p>综上所述，Django REST framework提供了丰富的支持，可以轻松实现用户会话管理、客户端认证和多因素认证等高级主题。开发人员可以根据项目需求选择合适的认证方式，并结合相关的第三方库来实现所需的功能。</p><h2 id=第10章：实战项目><a href=#第10章：实战项目 class=headerlink title=第10章：实战项目></a><strong>第10章：实战项目</strong></h2><p>建立一个简单的博客系统是一个很好的实战项目，可以涵盖认证与权限控制等方面。下面是一个基本的Django REST<br>framework博客系统的示例，其中包括了认证与权限控制的应用。</p><p>首先，我们需要创建一个Django应用，并定义博客文章的模型、序列化器、视图和URL配置。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br></pre></td><td class=code><pre><span class=line><span class=comment># models.py</span></span><br><span class=line><span class=keyword>from</span> django.db <span class=keyword>import</span> models</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">Post</span>(models.Model):</span><br><span class=line>    title = models.CharField(max_length=<span class=number>100</span>)</span><br><span class=line>    content = models.TextField()</span><br><span class=line>    author = models.ForeignKey(<span class=string>&#x27;auth.User&#x27;</span>, on_delete=models.CASCADE)</span><br><span class=line>    created_at = models.DateTimeField(auto_now_add=<span class=literal>True</span>)</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment># serializers.py</span></span><br><span class=line><span class=keyword>from</span> rest_framework <span class=keyword>import</span> serializers</span><br><span class=line><span class=keyword>from</span> .models <span class=keyword>import</span> Post</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">PostSerializer</span>(serializers.ModelSerializer):</span><br><span class=line>    <span class=keyword>class</span> <span class="title class_">Meta</span>:</span><br><span class=line>        model = Post</span><br><span class=line>        fields = [<span class=string>&#x27;id&#x27;</span>, <span class=string>&#x27;title&#x27;</span>, <span class=string>&#x27;content&#x27;</span>, <span class=string>&#x27;author&#x27;</span>, <span class=string>&#x27;created_at&#x27;</span>]</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment># views.py</span></span><br><span class=line><span class=keyword>from</span> rest_framework <span class=keyword>import</span> viewsets</span><br><span class=line><span class=keyword>from</span> .models <span class=keyword>import</span> Post</span><br><span class=line><span class=keyword>from</span> .serializers <span class=keyword>import</span> PostSerializer</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">PostViewSet</span>(viewsets.ModelViewSet):</span><br><span class=line>    queryset = Post.objects.<span class=built_in>all</span>()</span><br><span class=line>    serializer_class = PostSerializer</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=comment># urls.py</span></span><br><span class=line><span class=keyword>from</span> django.urls <span class=keyword>import</span> path, include</span><br><span class=line><span class=keyword>from</span> rest_framework.routers <span class=keyword>import</span> DefaultRouter</span><br><span class=line><span class=keyword>from</span> .views <span class=keyword>import</span> PostViewSet</span><br><span class=line></span><br><span class=line>router = DefaultRouter()</span><br><span class=line>router.register(<span class=string>r&#x27;posts&#x27;</span>, PostViewSet)</span><br><span class=line></span><br><span class=line>urlpatterns = [</span><br><span class=line>    path(<span class=string>&#x27;&#x27;</span>, include(router.urls)),</span><br><span class=line>]</span><br></pre></td></tr></table></figure><p>接下来，我们将添加认证与权限控制。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=comment># settings.py</span></span><br><span class=line></span><br><span class=line>INSTALLED_APPS = [</span><br><span class=line>    <span class=comment># ...</span></span><br><span class=line>    <span class=string>&#x27;rest_framework&#x27;</span>,</span><br><span class=line>    <span class=string>&#x27;blog&#x27;</span>,  <span class=comment># assuming &#x27;blog&#x27; is the name of the app</span></span><br><span class=line>]</span><br><span class=line></span><br><span class=line>REST_FRAMEWORK = &#123;</span><br><span class=line>    <span class=string>&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: [</span><br><span class=line>        <span class=string>&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class=line>    ],</span><br><span class=line>    <span class=string>&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: [</span><br><span class=line>        <span class=string>&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,</span><br><span class=line>        <span class=string>&#x27;rest_framework.authentication.TokenAuthentication&#x27;</span>,</span><br><span class=line>    ],</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>在上述代码中，我们将默认权限设置为IsAuthenticated，这意味着只有经过身份验证的用户才能访问API。我们还配置了SessionAuthentication和TokenAuthentication作为默认的认证类，这样用户可以使用会话验证或令牌验证进行身份验证。</p><p>最后，我们需要为用户创建博客文章的权限。我们可以使用Django的自定义权限类来实现这一点。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=comment># permissions.py</span></span><br><span class=line><span class=keyword>from</span> rest_framework <span class=keyword>import</span> permissions</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">IsAuthorOrReadOnly</span>(permissions.BasePermission):</span><br><span class=line>    <span class=keyword>def</span> <span class="title function_">has_object_permission</span>(<span class=params>self, request, view, obj</span>):</span><br><span class=line>        <span class=keyword>if</span> request.method <span class=keyword>in</span> permissions.SAFE_METHODS:</span><br><span class=line>            <span class=keyword>return</span> <span class=literal>True</span></span><br><span class=line>        <span class=keyword>return</span> obj.author == request.user</span><br></pre></td></tr></table></figure><p>然后，将这个权限类应用到我们的视图中。</p><figure class="highlight python"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line><span class=comment># views.py</span></span><br><span class=line><span class=keyword>from</span> rest_framework <span class=keyword>import</span> viewsets</span><br><span class=line><span class=keyword>from</span> .models <span class=keyword>import</span> Post</span><br><span class=line><span class=keyword>from</span> .serializers <span class=keyword>import</span> PostSerializer</span><br><span class=line><span class=keyword>from</span> .permissions <span class=keyword>import</span> IsAuthorOrReadOnly</span><br><span class=line></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">PostViewSet</span>(viewsets.ModelViewSet):</span><br><span class=line>    queryset = Post.objects.<span class=built_in>all</span>()</span><br><span class=line>    serializer_class = PostSerializer</span><br><span class=line>    permission_classes = [IsAuthorOrReadOnly]</span><br></pre></td></tr></table></figure><p>现在，我们已经完成了一个简单的博客系统，并应用了认证与权限控制。用户需要经过身份验证才能访问API，并且只有文章的作者才有权限对文章进行修改或删除。</p><h2 id=第11章：最佳实践与高级技巧><a href=#第11章：最佳实践与高级技巧 class=headerlink title=第11章：最佳实践与高级技巧></a><strong>第11章：最佳实践与高级技巧</strong></h2><h3 id=性能优化><a href=#性能优化 class=headerlink title=性能优化></a>性能优化</h3><ol><li><strong>数据库优化</strong>：使用索引、合理设计数据库结构、避免N+1查询等。</li><li><strong>缓存</strong>：使用缓存技术（如Redis、Memcached）缓存频繁访问的数据。</li><li><strong>异步任务</strong>：将耗时任务异步化，可以使用Celery等工具。</li><li><strong>代码优化</strong>：避免过多的数据库查询、减少不必要的计算、优化算法等。</li></ol><h3 id=安全注意事项><a href=#安全注意事项 class=headerlink title=安全注意事项></a>安全注意事项</h3><ol><li><strong>数据加密</strong>：对敏感数据进行加密存储。</li><li><strong>防止跨站脚本攻击（XSS）</strong> ：对用户输入进行过滤和转义。</li><li><strong>防止SQL注入</strong>：使用ORM或参数化查询来防止SQL注入攻击。</li><li><strong>权限控制</strong>：确保用户只能访问其有权限的资源。</li><li><strong>保持系统更新</strong>：定期更新框架、库和操作系统，以修复潜在的安全漏洞。</li></ol><h3 id=未来趋势与更新><a href=#未来趋势与更新 class=headerlink title=未来趋势与更新></a>未来趋势与更新</h3><ol><li><strong>微服务架构</strong>：将应用拆分为小型的、独立部署的服务。</li><li><strong>容器化</strong>：使用Docker等容器技术实现应用的快速部署和扩展。</li><li><strong>Serverless架构</strong>：无需管理服务器，按需运行代码，降低运维成本。</li><li><strong>人工智能与机器学习</strong>：将人工智能技术应用于应用开发中，实现智能化功能。</li><li><strong>持续集成与持续部署</strong>：采用CI&#x2F;CD流程实现快速迭代和交付。</li></ol><h2 id=附录><a href=#附录 class=headerlink title=附录></a><strong>附录</strong></h2><h3 id=Django官方文档链接><a href=#Django官方文档链接 class=headerlink title=Django官方文档链接></a>Django官方文档链接</h3><p>你可以在<a class=link target=_blank rel=noopener href=https://docs.djangoproject.com/en/stable/ >Django官方文档<i class="fas fa-external-link-alt"></i></a>中找到最新的Django文档，包括教程、API参考和发布说明等。</p><h3 id=常见问题解答><a href=#常见问题解答 class=headerlink title=常见问题解答></a>常见问题解答</h3><ol><li><strong>Stack Overflow</strong>：在Stack Overflow上搜索相关问题，通常能找到解决方案。</li><li><strong>Django官方论坛</strong>：官方网站上有一个社区论坛，你可以在这里提问和寻求帮助。</li><li><strong>GitHub Issues</strong>：如果你使用的是开源的Django项目或库，可以在对应的GitHub仓库的Issues中查找或提问问题。</li></ol><h3 id=工具和库推荐><a href=#工具和库推荐 class=headerlink title=工具和库推荐></a>工具和库推荐</h3><ol><li><strong>Django REST framework</strong>：用于构建Web API的强大工具。</li><li><strong>Celery</strong>：用于处理异步任务和定时任务的分布式任务队列。</li><li><strong>Django Debug Toolbar</strong>：用于在开发阶段进行性能分析和调试的工具。</li><li><strong>Django Channels</strong>：为Django引入了实时的、异步的通信协议，用于构建实时应用。</li><li><strong>Django Allauth</strong>：提供了完整的用户认证和账户管理功能，包括社交账号登录、邮箱验证等。</li></ol><p>这些工具和库都是Django社区广泛使用和推荐的，可以帮助你更高效地开发和管理Django应用。</p></div><script>"undefined"!=typeof Prism&&"undefined"!=typeof mermaid&&mermaid.initialize({startOnLoad:!0,theme:"dark"===document.documentElement.getAttribute("data-theme")?"dark":"default"})</script><div class="post-copyright-info-container border-box"><div class="copyright-info-content border-box"><div class="copyright-info-top border-box"><div class="copyright-post-title border-box text-ellipsis">深入Django：用户认证与权限控制实战指南</div><div class="copyright-post-link border-box text-ellipsis">2024/05/07/back_end/django/深入django：用户认证与权限控制实战指南/</div></div><div class="copyright-info-bottom border-box"><div class="copyright-post-author bottom-item"><div class=type>作者</div><div class=content>cmdragon</div></div><div class="post-time bottom-item"><div class=type>发布于</div><div class=content>2024-05-07 18:50</div></div><div class="post-license bottom-item"><div class=type>许可</div><div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0"><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed target=_blank><i class="fa-brands fa-creative-commons"></i> <i class="fa-brands fa-creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc"></i> <i class="fa-brands fa-creative-commons-sa"></i></a></div></div></div><i class="copyright-bg fa-solid fa-copyright"></i></div><div class="copy-copyright-info flex-center tooltip" data-tooltip-content=复制版权信息 data-tooltip-offset-y=-2px><i class="fa-solid fa-copy"></i></div></div><div class="post-bottom-tags-and-share border-box"><div><ul class="post-tags-box border-box"><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Auth/ >Auth</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Decorators/ >Decorators</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Permissions/ >Permissions</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/Guardian/ >Guardian</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/RESTAuth/ >RESTAuth</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/SessionMgmt/ >SessionMgmt</a></li><li class="tag-item border-box"><i class="icon fas fa-hashtag"></i>&nbsp;<a href=/tags/MFA/ >MFA</a></li></ul></div><div><div class="post-share-container border-box"><ul class="share-list-wrap border-box"><li class="qq share-item border-box flex-center tooltip" data-tooltip-content="分享到 QQ"><i class="fa-brands fa-qq"></i></li><li class="wechat share-item border-box flex-center tooltip tooltip-img" data-tooltip-content=分享到微信 data-tooltip-img-tip=微信扫一扫 data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"><i class="fa-brands fa-weixin"></i></li><li class="weibo share-item border-box flex-center tooltip" data-tooltip-content=分享到微博><i class="fa-brands fa-weibo"></i></li></ul></div></div></div><div class="reward-author-container border-box flex-center"><div class="reward-btn keep-button border-box flex-center tooltip tooltip-img" data-tooltip-content=打赏作者一包辣条！ data-tooltip-img-url=/images/payment.jpg data-tooltip-img-trigger=click data-tooltip-img-style="top: -8px;"><i class="fa-solid fa-hand-holding-heart"></i></div></div><div class="post-nav border-box"><div class=prev-post><a class=prev rel=prev href=/2024/05/08/back_end/django/django%20admin%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%EF%BC%9A%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E4%B8%8E%E5%AE%9E%E8%B7%B5/ title="Django Admin后台管理：高效开发与实践"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">Django Admin后台管理：高效开发与实践</span> <span class=post-nav-item>上一篇</span></span></a></div><div class=next-post><a class=next rel=next href=/2024/05/06/back_end/django/django%E9%AB%98%E7%BA%A7%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86%E4%B8%8E%E9%AA%8C%E8%AF%81%E5%AE%9E%E6%88%98/ title=Django高级表单处理与验证实战><span class="title flex-center"><span class="post-nav-title-item text-ellipsis">Django高级表单处理与验证实战</span> <span class=post-nav-item>下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div><div class="pc-post-toc right-toc"><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC1%E7%AB%A0%EF%BC%9A%E5%85%A5%E9%97%A8Django%E4%B8%8E%E8%AE%BE%E7%BD%AE><span class=nav-number>1.</span> <span class=nav-text>第1章：入门Django与设置</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-1-Django%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE><span class=nav-number>1.1.</span> <span class=nav-text>1.1 Django安装与环境配置</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#1-2-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AADjango%E9%A1%B9%E7%9B%AE%E5%92%8C%E5%BA%94%E7%94%A8><span class=nav-number>1.2.</span> <span class=nav-text>1.2 创建第一个Django项目和应用</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#1-3-%E8%AE%BE%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9E%8B><span class=nav-number>1.3.</span> <span class=nav-text>1.3 设置基础用户模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC2%E7%AB%A0%EF%BC%9ADjango%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F><span class=nav-number>2.</span> <span class=nav-text>第2章：Django认证系统</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#2-1-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3><span class=nav-number>2.1.</span> <span class=nav-text>2.1 用户模型详解</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#2-2-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E3%80%81%E7%99%BB%E5%BD%95%E4%B8%8E%E9%AA%8C%E8%AF%81><span class=nav-number>2.2.</span> <span class=nav-text>2.2 用户注册、登录与验证</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81%E8%A7%86%E5%9B%BE%E5%92%8CURL><span class=nav-number>2.3.</span> <span class=nav-text>2.3 自定义认证视图和URL</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#2-4-CSRF%E4%BF%9D%E6%8A%A4><span class=nav-number>2.4.</span> <span class=nav-text>2.4 CSRF保护</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC3%E7%AB%A0%EF%BC%9A%E8%AE%A4%E8%AF%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%92%8C%E4%BF%A1%E5%8F%B7><span class=nav-number>3.</span> <span class=nav-text>第3章：认证中间件和信号</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-1-%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%9C%A8%E8%AE%A4%E8%AF%81%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8><span class=nav-number>3.1.</span> <span class=nav-text>3.1 中间件在认证中的作用</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#3-2-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86><span class=nav-number>3.2.</span> <span class=nav-text>3.2 用户登录状态管理</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#3-3-%E8%AE%A4%E8%AF%81%E4%BF%A1%E5%8F%B7%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86><span class=nav-number>3.3.</span> <span class=nav-text>3.3 认证信号与事件处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80><span class=nav-number>4.</span> <span class=nav-text>第4章：权限系统基础</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#4-1-Django%E5%86%85%E7%BD%AE%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B><span class=nav-number>4.1.</span> <span class=nav-text>4.1 Django内置权限模型</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#4-2-%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E4%B8%8E%E6%9D%83%E9%99%90%E5%85%B3%E8%81%94><span class=nav-number>4.2.</span> <span class=nav-text>4.2 用户角色与权限关联</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#4-3-%E5%88%86%E7%BB%84%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86><span class=nav-number>4.3.</span> <span class=nav-text>4.3 分组与权限管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC5%E7%AB%A0%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E5%92%8C%E9%AA%8C%E8%AF%81><span class=nav-number>5.</span> <span class=nav-text>第5章：自定义权限和验证</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#5-1-%E4%BD%BF%E7%94%A8-permission-required%E8%A3%85%E9%A5%B0%E5%99%A8><span class=nav-number>5.1.</span> <span class=nav-text>5.1 使用@permission_required装饰器</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#5-2-%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E7%B1%BB><span class=nav-number>5.2.</span> <span class=nav-text>5.2 编写自定义权限类</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#5-3-%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5><span class=nav-number>5.3.</span> <span class=nav-text>5.3 权限验证最佳实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6%EF%BC%88%E5%A6%82django-guardian%EF%BC%89><span class=nav-number>6.</span> <span class=nav-text>第6章：权限管理框架（如django-guardian）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#6-1-django-guardian%E7%9A%84%E4%BB%8B%E7%BB%8D><span class=nav-number>6.1.</span> <span class=nav-text>6.1 django-guardian的介绍</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#6-2-%E7%BB%86%E5%8C%96%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6><span class=nav-number>6.2.</span> <span class=nav-text>6.2 细化权限控制</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#6-3-%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA><span class=nav-number>6.3.</span> <span class=nav-text>6.3 实例演示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC7%E7%AB%A0%EF%BC%9A%E8%A7%86%E5%9B%BE%E5%92%8C%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6><span class=nav-number>7.</span> <span class=nav-text>第7章：视图和模板的权限控制</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#7-1-%E5%9C%A8%E8%A7%86%E5%9B%BE%E4%B8%AD%E6%A3%80%E6%9F%A5%E6%9D%83%E9%99%90><span class=nav-number>7.1.</span> <span class=nav-text>7.1 在视图中检查权限</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#7-2-%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E6%98%BE%E7%A4%BA%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF><span class=nav-number>7.2.</span> <span class=nav-text>7.2 在模板中显示权限相关信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC8%E7%AB%A0%EF%BC%9ARESTful-API%E7%9A%84%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%9D%83%E9%99%90><span class=nav-number>8.</span> <span class=nav-text>第8章：RESTful API的认证与权限</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#8-1-Django-REST-framework%E7%9A%84%E8%AE%A4%E8%AF%81%E9%9B%86%E6%88%90><span class=nav-number>8.1.</span> <span class=nav-text>8.1 Django REST framework的认证集成</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#8-2-API%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5><span class=nav-number>8.2.</span> <span class=nav-text>8.2 API权限控制策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC9%E7%AB%A0%EF%BC%9A%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98><span class=nav-number>9.</span> <span class=nav-text>第9章：高级主题</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#9-1-%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86><span class=nav-number>9.1.</span> <span class=nav-text>9.1 用户会话管理</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#9-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%A4%E8%AF%81%EF%BC%88OAuth2%E3%80%81JWT%E7%AD%89%EF%BC%89><span class=nav-number>9.2.</span> <span class=nav-text>9.2 客户端认证（OAuth2、JWT等）</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#9-3-%E5%A4%9A%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81%EF%BC%88MFA%EF%BC%89><span class=nav-number>9.3.</span> <span class=nav-text>9.3 多因素认证（MFA）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC10%E7%AB%A0%EF%BC%9A%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE><span class=nav-number>10.</span> <span class=nav-text>第10章：实战项目</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC11%E7%AB%A0%EF%BC%9A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7><span class=nav-number>11.</span> <span class=nav-text>第11章：最佳实践与高级技巧</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96><span class=nav-number>11.1.</span> <span class=nav-text>性能优化</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9><span class=nav-number>11.2.</span> <span class=nav-text>安全注意事项</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9C%AA%E6%9D%A5%E8%B6%8B%E5%8A%BF%E4%B8%8E%E6%9B%B4%E6%96%B0><span class=nav-number>11.3.</span> <span class=nav-text>未来趋势与更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%99%84%E5%BD%95><span class=nav-number>12.</span> <span class=nav-text>附录</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Django%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%93%BE%E6%8E%A5><span class=nav-number>12.1.</span> <span class=nav-text>Django官方文档链接</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94><span class=nav-number>12.2.</span> <span class=nav-text>常见问题解答</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%B7%A5%E5%85%B7%E5%92%8C%E5%BA%93%E6%8E%A8%E8%8D%90><span class=nav-number>12.3.</span> <span class=nav-text>工具和库推荐</span></a></li></ol></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom border-box"><footer class="footer border-box"><div class="copyright-info info-item">&copy;&nbsp;<span>2023</span>&nbsp;-&nbsp;2025 &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a target=_blank rel=noopener href=https://stats.uptimerobot.com/9mwrCwss4f>All systems status</a></div><div class="theme-info info-item">由&nbsp;<a target=_blank href=/ >Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class=keep-version target=_blank href=/ >Keep</a></div><div class="deploy-info info-item"><a target=_blank rel=nofollow href=https://tools.cmdragon.cn/ >本站由 <span class=tooltip data-tooltip-content="GitHub Pages"><img src=/images/brands/github.png alt=deploy></span>提供部署服务</a></div></footer></div></div><div class="post-tools right-toc"><div class="post-tools-container border-box"><ul class="tools-list border-box"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center full-screen"><i class="fa-solid fa-expand"></i></li></ul></div></div><div class=side-tools><div class="side-tools-container border-box"><ul class="side-tools-list side-tools-show-handle border-box"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-toggle-theme-mode flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class=flex-center href=/atom.xml target=_blank><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list border-box"><li class="tools-item toggle-show-toc-tablet flex-center"><i class="fas fa-list"></i></li><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center show-arrow"><i class="arrow fas fa-arrow-up"></i> <span class=percent></span></li></ul></div></div><div class=zoom-in-image-mask><img class=zoom-in-image></div><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-input-field-pre><i class="fas fa-keyboard"></i></span><div class=search-input-container><input autocomplete=off autocorrect=off autocapitalize=off placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=close-popup-btn><i class="fas fa-times"></i></span></div><div id=search-result><div id=no-result><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><div class=tablet-post-toc-mask><div class=tablet-post-toc><div class="post-toc-wrap border-box"><div class="post-toc border-box"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC1%E7%AB%A0%EF%BC%9A%E5%85%A5%E9%97%A8Django%E4%B8%8E%E8%AE%BE%E7%BD%AE><span class=nav-number>1.</span> <span class=nav-text>第1章：入门Django与设置</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-1-Django%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE><span class=nav-number>1.1.</span> <span class=nav-text>1.1 Django安装与环境配置</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#1-2-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AADjango%E9%A1%B9%E7%9B%AE%E5%92%8C%E5%BA%94%E7%94%A8><span class=nav-number>1.2.</span> <span class=nav-text>1.2 创建第一个Django项目和应用</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#1-3-%E8%AE%BE%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9E%8B><span class=nav-number>1.3.</span> <span class=nav-text>1.3 设置基础用户模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC2%E7%AB%A0%EF%BC%9ADjango%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F><span class=nav-number>2.</span> <span class=nav-text>第2章：Django认证系统</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#2-1-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3><span class=nav-number>2.1.</span> <span class=nav-text>2.1 用户模型详解</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#2-2-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E3%80%81%E7%99%BB%E5%BD%95%E4%B8%8E%E9%AA%8C%E8%AF%81><span class=nav-number>2.2.</span> <span class=nav-text>2.2 用户注册、登录与验证</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81%E8%A7%86%E5%9B%BE%E5%92%8CURL><span class=nav-number>2.3.</span> <span class=nav-text>2.3 自定义认证视图和URL</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#2-4-CSRF%E4%BF%9D%E6%8A%A4><span class=nav-number>2.4.</span> <span class=nav-text>2.4 CSRF保护</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC3%E7%AB%A0%EF%BC%9A%E8%AE%A4%E8%AF%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%92%8C%E4%BF%A1%E5%8F%B7><span class=nav-number>3.</span> <span class=nav-text>第3章：认证中间件和信号</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-1-%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%9C%A8%E8%AE%A4%E8%AF%81%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8><span class=nav-number>3.1.</span> <span class=nav-text>3.1 中间件在认证中的作用</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#3-2-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86><span class=nav-number>3.2.</span> <span class=nav-text>3.2 用户登录状态管理</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#3-3-%E8%AE%A4%E8%AF%81%E4%BF%A1%E5%8F%B7%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86><span class=nav-number>3.3.</span> <span class=nav-text>3.3 认证信号与事件处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80><span class=nav-number>4.</span> <span class=nav-text>第4章：权限系统基础</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#4-1-Django%E5%86%85%E7%BD%AE%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B><span class=nav-number>4.1.</span> <span class=nav-text>4.1 Django内置权限模型</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#4-2-%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E4%B8%8E%E6%9D%83%E9%99%90%E5%85%B3%E8%81%94><span class=nav-number>4.2.</span> <span class=nav-text>4.2 用户角色与权限关联</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#4-3-%E5%88%86%E7%BB%84%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86><span class=nav-number>4.3.</span> <span class=nav-text>4.3 分组与权限管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC5%E7%AB%A0%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E5%92%8C%E9%AA%8C%E8%AF%81><span class=nav-number>5.</span> <span class=nav-text>第5章：自定义权限和验证</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#5-1-%E4%BD%BF%E7%94%A8-permission-required%E8%A3%85%E9%A5%B0%E5%99%A8><span class=nav-number>5.1.</span> <span class=nav-text>5.1 使用@permission_required装饰器</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#5-2-%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E7%B1%BB><span class=nav-number>5.2.</span> <span class=nav-text>5.2 编写自定义权限类</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#5-3-%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5><span class=nav-number>5.3.</span> <span class=nav-text>5.3 权限验证最佳实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6%EF%BC%88%E5%A6%82django-guardian%EF%BC%89><span class=nav-number>6.</span> <span class=nav-text>第6章：权限管理框架（如django-guardian）</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#6-1-django-guardian%E7%9A%84%E4%BB%8B%E7%BB%8D><span class=nav-number>6.1.</span> <span class=nav-text>6.1 django-guardian的介绍</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#6-2-%E7%BB%86%E5%8C%96%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6><span class=nav-number>6.2.</span> <span class=nav-text>6.2 细化权限控制</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#6-3-%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA><span class=nav-number>6.3.</span> <span class=nav-text>6.3 实例演示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC7%E7%AB%A0%EF%BC%9A%E8%A7%86%E5%9B%BE%E5%92%8C%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6><span class=nav-number>7.</span> <span class=nav-text>第7章：视图和模板的权限控制</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#7-1-%E5%9C%A8%E8%A7%86%E5%9B%BE%E4%B8%AD%E6%A3%80%E6%9F%A5%E6%9D%83%E9%99%90><span class=nav-number>7.1.</span> <span class=nav-text>7.1 在视图中检查权限</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#7-2-%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E6%98%BE%E7%A4%BA%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF><span class=nav-number>7.2.</span> <span class=nav-text>7.2 在模板中显示权限相关信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC8%E7%AB%A0%EF%BC%9ARESTful-API%E7%9A%84%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%9D%83%E9%99%90><span class=nav-number>8.</span> <span class=nav-text>第8章：RESTful API的认证与权限</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#8-1-Django-REST-framework%E7%9A%84%E8%AE%A4%E8%AF%81%E9%9B%86%E6%88%90><span class=nav-number>8.1.</span> <span class=nav-text>8.1 Django REST framework的认证集成</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#8-2-API%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5><span class=nav-number>8.2.</span> <span class=nav-text>8.2 API权限控制策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC9%E7%AB%A0%EF%BC%9A%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98><span class=nav-number>9.</span> <span class=nav-text>第9章：高级主题</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#9-1-%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86><span class=nav-number>9.1.</span> <span class=nav-text>9.1 用户会话管理</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#9-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%A4%E8%AF%81%EF%BC%88OAuth2%E3%80%81JWT%E7%AD%89%EF%BC%89><span class=nav-number>9.2.</span> <span class=nav-text>9.2 客户端认证（OAuth2、JWT等）</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#9-3-%E5%A4%9A%E5%9B%A0%E7%B4%A0%E8%AE%A4%E8%AF%81%EF%BC%88MFA%EF%BC%89><span class=nav-number>9.3.</span> <span class=nav-text>9.3 多因素认证（MFA）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC10%E7%AB%A0%EF%BC%9A%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE><span class=nav-number>10.</span> <span class=nav-text>第10章：实战项目</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC11%E7%AB%A0%EF%BC%9A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7><span class=nav-number>11.</span> <span class=nav-text>第11章：最佳实践与高级技巧</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96><span class=nav-number>11.1.</span> <span class=nav-text>性能优化</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9><span class=nav-number>11.2.</span> <span class=nav-text>安全注意事项</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9C%AA%E6%9D%A5%E8%B6%8B%E5%8A%BF%E4%B8%8E%E6%9B%B4%E6%96%B0><span class=nav-number>11.3.</span> <span class=nav-text>未来趋势与更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%99%84%E5%BD%95><span class=nav-number>12.</span> <span class=nav-text>附录</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#Django%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%93%BE%E6%8E%A5><span class=nav-number>12.1.</span> <span class=nav-text>Django官方文档链接</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94><span class=nav-number>12.2.</span> <span class=nav-text>常见问题解答</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%B7%A5%E5%85%B7%E5%92%8C%E5%BA%93%E6%8E%A8%E8%8D%90><span class=nav-number>12.3.</span> <span class=nav-text>工具和库推荐</span></a></li></ol></li></ol></div></div></div></div></main><script src=/js/utils.js></script><script src=/js/header-shrink.js></script><script src=/js/back2top.js></script><script src=/js/toggle-theme.js></script><script src=/js/code-block.js></script><script src=/js/main.js></script><script src=/js/libs/anime.min.js></script><script src=/js/local-search.js></script><script src=/js/lazyload.js></script><div class=""><script src=/js/post/post-helper.js></script><script src=/js/post/toc.js></script><script src=/js/post/copyright-info.js></script><script src=/js/post/share.js></script><script defer=defer src=https://unpkg.com/mermaid/dist/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",()=>{"undefined"!=typeof mermaid&&mermaid.initialize({startOnLoad:!0,theme:"dark"===document.documentElement.getAttribute("data-theme")?"dark":"default"})})</script></div></body></html>